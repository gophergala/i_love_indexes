(function(){$(function(){var i,k,c,m,f,l,n,q,a,h,e,j,o,d,b,p,g;p=$("input[type=search]");b=$("#search-form");d=$("#results table tbody");n=$("#indices table tbody");g=$("input[type=url]");c=$("#add-url-form");k=$("#add-url");h=$("#list-url");e=$("#load-more");l=$("#indices");o=$("#results");f=$("#header");f.css("margin-top",$(window).height()/2-f.height()/1.5);p.on("input",function(s){var r;r=s.target.value;if(r){return a.search(r)}});e.on("click",function(r){a.loadMore();return r.preventDefault()});b.on("submit",function(r){return r.preventDefault()});c.on("submit",function(r){i(g.val());return r.preventDefault()});m=function(s,r,t){return setTimeout(function(){return s.removeClass(r)},t)};q=function(t,s,r){var u;u=$("<tr>").addClass("new-entry");m(u,"new-entry",3000);r.forEach(function(w){var v,x;x=$("<td>");if(w==="last_modified_at"){x.html(moment(s[w]).fromNow())}else{if(w==="url"){v=$("<a>").attr("href",s[w]).text(s[w]);x.append(v)}else{if(w==="name"){v=$("<a>").attr("href",s.url).text(s[w]);x.append(v)}else{if(w==="size"){if(s[w]===-1){x.html("- Directory -")}else{x.html(s[w])}}else{x.html(s[w])}}}}return u.append(x)});return t.append(u)};h.on("click",function(r){return j.toggle()});j=(function(){return{tickHandle:0,enable:function(){this.update();return this.tickHandle=setInterval((function(r){return function(){return r.update()}})(this),1000)},toggle:function(){if(this.tickHandle!==0){return this.disable()}else{return this.enable()}},disable:function(r){if(this.tickHandle!==0){clearInterval(this.tickHandle)}this.tickHandle=0;return l.fadeOut(r)},update:function(){return $.ajax({type:"GET",url:"/api/indices",dataType:"json",success:function(r){n.empty();r.forEach(function(t){var s;s=t.scheme+"://"+t.host+t.path;return q(n,{url:s,count:t.count},["url","count"])});f.animate({"margin-top":0},"slow");return o.fadeOut(function(){return l.fadeIn()})}})}}})();a=(function(){return{from:0,timeoutHandle:0,query:"",loadMore:function(){this.from+=10;return this._loadItems(this.query,(function(r){return function(s){return r._addItemsToTable(s,function(){return $("#about-link").ScrollTo({duration:2000})})}})(this))},search:function(r){if(r!==this.query){this.query=r;this.from=0}if(this.timeoutHandle!==0){clearTimeout(this.timeoutHandle);this.timeoutHandle=0}return this.timeoutHandle=setTimeout((function(s){return function(){s._loadItems(r,function(t){d.empty();return s._addItemsToTable(t)});return s.timeoutHandle=0}})(this),300)},_loadItems:function(s,r){return $.ajax({type:"GET",url:"/api/search",dataType:"json",data:{q:this.query,from:this.from},success:r})},_addItemsToTable:function(s,r){s.forEach(function(t){return q(d,t,["name","last_modified_at","size"])});f.animate({"margin-top":0},"slow");j.disable(function(){return o.fadeIn()});if(r){return r()}}}})();return i=function(r){return $.ajax({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",url:"/api/indices",data:JSON.stringify({url:r}),success:function(s){$("#btn-row .error").addClass("hidden");$("#btn-row .error").val("");g.val("");j.enable();k.addClass("green");return setTimeout(function(){return k.removeClass("green")},2400)},error:function(t,v){var s,w,u;s=$("#btn-row .error");k.addClass("red");setTimeout(function(){s.empty();return k.removeClass("red")},2400);if(t.status===500){return s.html("Internal Error, sorry :-/")}else{if(t.status===422){w=t.responseJSON.errors;u="<pre>";Object.keys(w).forEach(function(x){return w[x].forEach(function(y){return u+=x+": "+y+"\n"})});return s.html(u+"</pre>")}}}})}})}).call(this);